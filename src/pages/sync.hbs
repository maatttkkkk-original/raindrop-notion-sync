// MINIMAL SYNC PAGE - GUARANTEED TO LOAD
fastify.get('/sync', async (req, reply) => {
  const password = req.query.password || '';

  console.log('üîÑ Sync page requested with password:', password ? '[PROVIDED]' : '[MISSING]');

  // Validate password
  if (!validatePassword(password)) {
    console.log('‚ùå Password validation failed');
    return reply.view('error', {
      error: 'Invalid password',
      password: '',
      code: 'AUTH_ERROR',
      details: 'Please provide a valid password'
    });
  }

  try {
    console.log('‚úÖ Password valid, rendering sync page...');
    
    // MINIMAL template data - no complex logic
    const templateData = {
      password: password,
      mode: req.query.mode || 'smart',
      daysBack: 30,
      deleteOrphaned: false
    };

    console.log('üìÑ Template data:', templateData);

    reply.view('sync', templateData);
    
    console.log('‚úÖ Sync page rendered successfully');

  } catch (error) {
    console.error('‚ùå Sync page render error:', error);
    
    // Fallback: send basic HTML if template fails
    reply.type('text/html').send(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Sync Page</title>
        <link rel="stylesheet" href="/public/styles/design-system.css">
        <link rel="stylesheet" href="/public/styles/dashboard.css">
      </head>
      <body>
        <main class="dashboard-8-section">
          <div class="dashboard-section section-1 bg-white">
            <div class="section-content">
              <h1 class="text-huge">Smart Sync</h1>
            </div>
          </div>
          <div class="dashboard-divider"></div>
          <div class="dashboard-section section-2 bg-yellow">
            <div class="section-content">
              <button id="syncBtn" class="section-action-button text-huge text-black">
                Start Smart Sync
              </button>
            </div>
          </div>
          <div class="dashboard-divider"></div>
          <div class="dashboard-section section-3 bg-white">
            <div class="section-content">
              <div class="text-large">Ready to sync...</div>
            </div>
          </div>
          <div class="dashboard-divider"></div>
          <div class="dashboard-section section-4 bg-white">
            <div class="section-content">
              <div id="progress-text" class="text-medium">Click button to start</div>
            </div>
          </div>
          <div class="dashboard-divider"></div>
          <div class="dashboard-section section-5 bg-white">
            <div class="section-content">
              <div id="sync-stats" style="display: none;">Stats will appear here</div>
            </div>
          </div>
          <div class="dashboard-divider"></div>
          <div class="dashboard-section section-6 bg-white">
            <div class="section-content">
              <div id="efficiency-display" style="display: none;">Efficiency will appear here</div>
            </div>
          </div>
          <div class="dashboard-divider"></div>
          <div class="dashboard-section section-7 bg-white log-section">
            <div class="section-content">
              <div id="status" class="status-display" style="display: none; height: 100%; overflow-y: auto;"></div>
            </div>
          </div>
          <div class="dashboard-divider"></div>
          <div class="dashboard-section section-8 bg-light-gray">
            <div class="section-content">
              <a href="/?password=${password}" class="back-button text-large">Back ‚Ü∫</a>
            </div>
          </div>
        </main>
        <script src="/public/scripts/utils.js"></script>
        <script src="/public/scripts/sync.js"></script>
      </body>
      </html>
    `);
  }
});